# Video2SOPï¼šå°†ä»ªå™¨æ•™å­¦è§†é¢‘è½¬åŒ–ä¸ºSOP

åŸºäº AI çš„è§†é¢‘ç†è§£å’Œæ–‡æ¡£ç”Ÿæˆç³»ç»Ÿï¼Œä¸“é—¨ç”¨äºå°†å®éªŒå®¤ä»ªå™¨æ“ä½œæ•™å­¦è§†é¢‘è½¬æ¢ä¸ºæ ‡å‡†æ“ä½œæµç¨‹ï¼ˆSOPï¼‰æ–‡æ¡£ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹æ€§

- âœ… **è§†é¢‘ç†è§£**: åŸºäº Qwen3-VL-Plus æ¨¡å‹çš„è§†é¢‘å†…å®¹åˆ†æ
- âœ… **è¯­éŸ³è¯†åˆ«**: é›†æˆ Paraformer-V2 çš„éŸ³é¢‘è½¬å½•åŠŸèƒ½
- âœ… **SOPç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†æ“ä½œæµç¨‹æ–‡æ¡£
- âœ… **å®æ—¶å¤„ç†**: WebSocket å®ç°å®æ—¶çŠ¶æ€æ›´æ–°
- âœ… **å“åº”å¼ UI**: Next.js + TypeScript + Tailwind CSS
- âœ… **å¤šæ¨¡æ€åˆ†æ**: ç»“åˆè§†é¢‘å’ŒéŸ³é¢‘å†…å®¹è¿›è¡Œç»¼åˆåˆ†æ
- âœ… **æ“ä½œå†å²**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œç»“æœè¿½è¸ª

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   FastAPI       â”‚
â”‚   Frontend      â”‚                 â”‚   Backend       â”‚
â”‚   (ç«¯å£ 50001)  â”‚                 â”‚   (ç«¯å£ 8000)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚   LangGraph     â”‚
                                   â”‚   Agent         â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Qwen3-VL-Plus â”‚  â”‚  Paraformer-V2  â”‚
                    â”‚   (è§†é¢‘ç†è§£)     â”‚  â”‚   (è¯­éŸ³è¯†åˆ«)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚   OSS Storage   â”‚
                                   â”‚   (æ–‡ä»¶å­˜å‚¨)     â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `/root/app/.env` æ–‡ä»¶ï¼š
```env
# å¿…éœ€çš„é…ç½®
DASHSCOPE_API_KEY=your_dashscope_api_key_here

# OSS å­˜å‚¨é…ç½®ï¼ˆç”¨äºè§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶å­˜å‚¨ï¼‰
OSS_ACCESS_KEY_ID=your_oss_access_key_id
OSS_ACCESS_KEY_SECRET=your_oss_access_key_secret
OSS_ENDPOINT=your_oss_endpoint
OSS_BUCKET_NAME=your_bucket_name

# å¯é€‰çš„ LangSmith è°ƒè¯•é…ç½®
LANGSMITH_API_KEY=your_langsmith_api_key_here
LANGSMITH_TRACING=true
LANGSMITH_PROJECT=video2sop
```

### 2. ä¸€é”®å¯åŠ¨

**æ¨èæ–¹å¼ï¼ˆä¿®å¤ç‰ˆï¼‰**:
```bash
cd /root/app
./start_services_fixed.sh
```

**æ ‡å‡†æ–¹å¼**:
```bash
cd /root/app
./start_services.sh
```

### 3. æ‰‹åŠ¨å¯åŠ¨

**å¯åŠ¨åç«¯æœåŠ¡:**
```bash
cd /root/app/langgraph-agent
pip install -r requirements.txt
python main.py
```

**å¯åŠ¨å‰ç«¯æœåŠ¡:**
```bash
cd /root/app/chat-frontend
npm install
npm run dev
```

### 4. è®¿é—®åº”ç”¨

- ğŸŒ å‰ç«¯ç•Œé¢: http://127.0.0.1:50001
- ğŸ”§ åç«¯ API: http://127.0.0.1:8000
- ğŸ“Š å¥åº·æ£€æŸ¥: http://127.0.0.1:8000/health

## ğŸ“ é¡¹ç›®ç»“æ„

```
/root/app/
â”œâ”€â”€ langgraph-agent/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py                        # FastAPI ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ agent.py                       # LangGraph Agent
â”‚   â”œâ”€â”€ video_understanding_tool.py    # è§†é¢‘ç†è§£å·¥å…·
â”‚   â”œâ”€â”€ speech_tool.py                 # è¯­éŸ³è¯†åˆ«å·¥å…·
â”‚   â”œâ”€â”€ oss_manager.py                 # OSSå­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ requirements.txt               # Python ä¾èµ–
â”‚   â””â”€â”€ README.md                     # åç«¯æ–‡æ¡£
â”œâ”€â”€ chat-frontend/                     # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ä¸»é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoUploader.tsx     # è§†é¢‘ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ SpeechRecognitionPanel.tsx  # è¯­éŸ³è¯†åˆ«ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoUnderstandingPanel.tsx # è§†é¢‘ç†è§£ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ OperationHistory.tsx  # æ“ä½œå†å²ç»„ä»¶
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚       â””â”€â”€ useWebSocket.ts       # WebSocket é’©å­
â”‚   â”œâ”€â”€ package.json                  # å‰ç«¯ä¾èµ–
â”‚   â”œâ”€â”€ tailwind.config.js           # Tailwindé…ç½®
â”‚   â””â”€â”€ README.md                    # å‰ç«¯æ–‡æ¡£
â”œâ”€â”€ temp/
â”‚   â”œâ”€â”€ model_example/               # æ¨¡å‹ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ qwen3_vl_plus_video.py  # è§†é¢‘ç†è§£å‚è€ƒå®ç°
â”‚   â”‚   â””â”€â”€ paraformer-v2.py        # è¯­éŸ³è¯†åˆ«å‚è€ƒå®ç°
â”‚   â””â”€â”€ manuscript_video_understanding/  # ç”Ÿæˆçš„æ–‡æ¡£ç¤ºä¾‹
â”œâ”€â”€ start_services.sh                # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ TROUBLESHOOTING.md               # æ•…éšœæ’é™¤æŒ‡å—
â””â”€â”€ .env                            # ç¯å¢ƒå˜é‡é…ç½®
```

## ğŸ”§ API æ–‡æ¡£

### WebSocket ç«¯ç‚¹

**è¿æ¥åœ°å€:** `ws://127.0.0.1:8000/ws`

**æ¥æ”¶æ¶ˆæ¯æ ¼å¼:**
```json
// è§†é¢‘ä¸Šä¼ å®Œæˆ
{
  "type": "upload_complete",
  "video_url": "https://...",
  "audio_url": "https://...",
  "session_id": "session_123"
}

// è¯­éŸ³è¯†åˆ«å®Œæˆ
{
  "type": "speech_recognition_complete",
  "message": "è¯­éŸ³è¯†åˆ«å·²æ‰§è¡Œ",
  "result": "è½¬å½•æ–‡æœ¬å†…å®¹"
}

// è§†é¢‘ç†è§£å®Œæˆ
{
  "type": "video_understanding_complete",
  "message": "è§†é¢‘ç†è§£å·²æ‰§è¡Œ",
  "result": "SOPæ–‡æ¡£å†…å®¹",
  "fps": 2,
  "has_audio_context": true
}

// å·¥å…·è°ƒç”¨çŠ¶æ€
{
  "type": "tool_call",
  "tool_name": "video_understanding",
  "status": "running|completed"
}

// é”™è¯¯ä¿¡æ¯
{
  "type": "error",
  "content": "é”™è¯¯æè¿°"
}
```

### HTTP ç«¯ç‚¹

- `GET /` - æ ¹è·¯å¾„ä¿¡æ¯
- `GET /health` - å¥åº·æ£€æŸ¥
- `POST /video_upload` - è§†é¢‘ä¸Šä¼ 
- `POST /speech_recognition` - è¯­éŸ³è¯†åˆ«
- `POST /video_understanding` - è§†é¢‘ç†è§£
- `POST /cleanup_files` - æ¸…ç†æ–‡ä»¶

## ğŸ”„ å·¥ä½œæµç¨‹

1. **è§†é¢‘ä¸Šä¼ ** â†’ ç”¨æˆ·ä¸Šä¼ å®éªŒå®¤ä»ªå™¨æ“ä½œè§†é¢‘
2. **è¯­éŸ³è¯†åˆ«** â†’ è‡ªåŠ¨æå–è§†é¢‘ä¸­çš„éŸ³é¢‘å¹¶è¿›è¡Œè½¬å½•
3. **è§†é¢‘ç†è§£** â†’ ç»“åˆè§†é¢‘å’ŒéŸ³é¢‘å†…å®¹ï¼Œä½¿ç”¨ Qwen3-VL-Plus åˆ†ææ“ä½œæµç¨‹
4. **SOPç”Ÿæˆ** â†’ ç”ŸæˆåŒ…å«æ ‡é¢˜ã€æ‘˜è¦ã€å…³é”®è¯ã€ææ–™æ¸…å•ã€æ“ä½œæ­¥éª¤çš„æ ‡å‡†æ“ä½œæµç¨‹æ–‡æ¡£
5. **ç»“æœå±•ç¤º** â†’ åœ¨æ“ä½œå†å²ä¸­è®°å½•å¹¶æ˜¾ç¤ºç”Ÿæˆçš„SOPæ–‡æ¡£

## ğŸ¨ ç•Œé¢ç‰¹æ€§

- **å“åº”å¼è®¾è®¡**: ä½¿ç”¨ Tailwind CSSï¼Œæ”¯æŒå¤šç§å±å¹•å°ºå¯¸
- **ç»„ä»¶å®½åº¦**: ä¸»å·¦åŒºåŸŸæ‰€æœ‰ç»„ä»¶ä½¿ç”¨ `max-w-4xl` (896px) æä¾›å……è¶³ç©ºé—´
- **Markdownæ¸²æŸ“**: æ”¯æŒ Markdown æ ¼å¼çš„ç»“æœå±•ç¤ºå’Œæºç æŸ¥çœ‹åˆ‡æ¢
- **å®æ—¶çŠ¶æ€**: WebSocket å®æ—¶æ›´æ–°æ“ä½œçŠ¶æ€å’Œè¿›åº¦
- **æ“ä½œå†å²**: å®Œæ•´è®°å½•æ‰€æœ‰æ“ä½œï¼Œæ–°è®°å½•æ˜¾ç¤ºåœ¨åº•éƒ¨

## ğŸ› æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) æ–‡ä»¶ã€‚

å¸¸è§é—®é¢˜ï¼š
1. **WebSocket è¿æ¥å¤±è´¥** - æ£€æŸ¥ä»£ç†è®¾ç½®ï¼Œä½¿ç”¨ `127.0.0.1` è€Œä¸æ˜¯ `localhost`
2. **API å¯†é’¥é”™è¯¯** - ç¡®ä¿åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®äº†æœ‰æ•ˆçš„ `DASHSCOPE_API_KEY`
3. **OSSé…ç½®é”™è¯¯** - ç¡®ä¿æ­£ç¡®é…ç½®äº† OSS å­˜å‚¨å‚æ•°
4. **ç«¯å£å†²çª** - æ£€æŸ¥ç«¯å£ 8000 å’Œ 50001 æ˜¯å¦è¢«å ç”¨
5. **è§†é¢‘æ ¼å¼ä¸æ”¯æŒ** - ç¡®ä¿ä¸Šä¼ çš„è§†é¢‘æ ¼å¼ä¸º MP4, MOV, AVI, MKV, WEBM

## ğŸ§ª æµ‹è¯•

### æµ‹è¯• WebSocket è¿æ¥
```bash
cd /root/app/langgraph-agent
python -c "
import asyncio
import websockets
import json

async def test_ws():
    uri = 'ws://127.0.0.1:8000/ws'
    async with websockets.connect(uri) as websocket:
        print('WebSocket è¿æ¥æˆåŠŸ')
        # ç›‘å¬æ¶ˆæ¯
        while True:
            try:
                message = await websocket.recv()
                data = json.loads(message)
                print('æ”¶åˆ°æ¶ˆæ¯:', data)
            except websockets.exceptions.ConnectionClosed:
                print('è¿æ¥å·²å…³é—­')
                break

asyncio.run(test_ws())
"
```

### æµ‹è¯• HTTP å¥åº·æ£€æŸ¥
```bash
curl --noproxy '*' http://127.0.0.1:8000/health
```

### å®Œæ•´è¿æ¥æµ‹è¯•
```bash
cd /root/app
python test_connection.py
```

## ğŸ“ å¼€å‘è¯´æ˜

### åç«¯å¼€å‘
- ä½¿ç”¨ FastAPI æ¡†æ¶
- æ”¯æŒå¼‚æ­¥ WebSocket è¿æ¥
- é›†æˆ LangGraph çŠ¶æ€å›¾
- æ”¯æŒ LangSmith è¿½è¸ª
- OSS æ–‡ä»¶å­˜å‚¨ç®¡ç†
- å¤šæ¨¡æ€ AI æ¨¡å‹é›†æˆ

### å‰ç«¯å¼€å‘
- ä½¿ç”¨ Next.js 15 + TypeScript
- Tailwind CSS æ ·å¼ + Typography æ’ä»¶
- è‡ªå®šä¹‰ WebSocket Hook
- å“åº”å¼è®¾è®¡
- Markdown æ¸²æŸ“æ”¯æŒ

## ğŸ”„ æ›´æ–°æ—¥å¿—

- **v1.1.0** - Video2SOP ç‰ˆæœ¬
  - é›†æˆ Qwen3-VL-Plus è§†é¢‘ç†è§£æ¨¡å‹
  - é›†æˆ Paraformer-V2 è¯­éŸ³è¯†åˆ«
  - å®ç°è§†é¢‘ä¸Šä¼ å’Œ OSS å­˜å‚¨
  - æ·»åŠ è§†é¢‘ç†è§£ç»„ä»¶å’Œæ“ä½œå†å²
  - æ”¯æŒ SOP æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
  - ä¼˜åŒ–ç•Œé¢å¸ƒå±€å’Œç”¨æˆ·ä½“éªŒ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**æ³¨æ„**: 
- è¯·ç¡®ä¿åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®æœ‰æ•ˆçš„ `DASHSCOPE_API_KEY`ï¼Œå¦åˆ™ AI æ¨¡å‹æ— æ³•æ­£å¸¸å·¥ä½œ
- è¯·é…ç½® OSS å­˜å‚¨å‚æ•°ï¼Œç”¨äºè§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶çš„å­˜å‚¨
- ç³»ç»Ÿæ”¯æŒæœ€å¤§ 500MB çš„è§†é¢‘æ–‡ä»¶ä¸Šä¼ 
- ç”Ÿæˆçš„ SOP æ–‡æ¡£å°†åŒ…å«æ ‡é¢˜ã€æ‘˜è¦ã€å…³é”®è¯ã€ææ–™æ¸…å•å’Œè¯¦ç»†æ“ä½œæ­¥éª¤
